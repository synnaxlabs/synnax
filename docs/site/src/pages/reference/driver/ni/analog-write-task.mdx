---
layout: "@/layouts/Reference.astro"
title: "NI Analog Write Task"
description: "Learn how to use Analog Write Tasks for NI hardware."
prev: "Analog Read Task"
prevURL: "/reference/driver/ni/analog-read-task"
next: "Counter Read Task"
nextURL: "/reference/driver/ni/counter-read-task"
---

import { Divider, Note, Icon, Text } from "@synnaxlabs/pluto";
import { Video, Image } from "@/components/Media";
import { Fragment } from "react";
import ChannelTypeDetails from "@/components/details/ChannelTypeDetails.astro";
import ExampleDetails from "@/components/details/ExampleDetails.astro";
import { Client } from "@/components/client";
import { mdxOverrides } from "@/components/mdxOverrides";
export const components = mdxOverrides;

Sends control commands to analog outputs on NI devices.

<Divider.Divider x />

## How Commands Work

Write tasks use **command** and **state** channels:

- **Command channels** (`_cmd`): Write values here to set analog outputs
- **State channels** (`_state`): Reflect the current output state
- **Command time channels** (`_cmd_time`): Index channels storing command timestamps

When you write to a command channel, the task processes it and updates the state channel, providing acknowledgment that the command was executed.

<Divider.Divider x />

## Task Configuration Reference

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| `name` | string | Yes | - | Human-readable task name |
| `state_rate` | number | No | `20` | Rate (Hz) at which state channels are updated |
| `data_saving` | boolean | No | `false` | Enable permanent storage in Synnax |
| `auto_start` | boolean | No | `false` | Automatically start task after configuration |
| `channels` | array | Yes | - | List of analog output channel configurations |

<Divider.Divider x />

## Channel Types Reference

<ChannelTypeDetails>
<Text.Text slot="summary" level="p"><Icon.Units.Voltage /> Voltage ([`ao_voltage`](https://www.ni.com/docs/en-US/bundle/ni-daqmx-c-api-ref/page/daqmxcfunc/daqmxcreateaovoltagechan.html))</Text.Text>

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| `cmd_channel` | number | Yes | - | Synnax command channel key |
| `state_channel` | number | Yes | - | Synnax state channel key |
| `device` | string | Yes | - | Device identifier |
| `port` | number | Yes | - | Physical port |
| `min_val` | number | No | `-10.0` | Minimum voltage (Volts) |
| `max_val` | number | No | `10.0` | Maximum voltage (Volts) |
| `custom_scale` | object | No | - | Custom scaling |

</ChannelTypeDetails>

<ChannelTypeDetails>
<Text.Text slot="summary" level="p"><Icon.Units.Current /> Current ([`ao_current`](https://www.ni.com/docs/en-US/bundle/ni-daqmx-c-api-ref/page/daqmxcfunc/daqmxcreateaocurrentchan.html))</Text.Text>

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| `cmd_channel` | number | Yes | - | Synnax command channel key |
| `state_channel` | number | Yes | - | Synnax state channel key |
| `device` | string | Yes | - | Device identifier |
| `port` | number | Yes | - | Physical port |
| `min_val` | number | No | `0.004` | Minimum current (Amps) |
| `max_val` | number | No | `0.02` | Maximum current (Amps) |
| `custom_scale` | object | No | - | Custom scaling |

</ChannelTypeDetails>

<Divider.Divider x />

## Important Rules

- **Command/State pairs**: Each analog output requires both a command and state channel
- **One task per module**: Only one running task can claim a module at a time.
- **State rate**: Higher state rates provide faster feedback but consume more resources

<Divider.Divider x />

## How To

<Client.Tabs client:only="react">
  <Fragment slot="console">
    <Video
      client:only="react"
      id="device-drivers/ni/analog-write-task/select-device"
    />
  </Fragment>
  <Fragment slot="python">

<ExampleDetails>
<Text.Text slot="summary" level="p"><Icon.Play /> Configure and Run Task</Text.Text>

```python
import synnax as sy
from synnax.hardware import ni

client = sy.Synnax()

# Retrieve device
dev = client.hardware.devices.retrieve(name="my_daq")

# Create command time index
ao_cmd_time = client.channels.create(
    name="ao_cmd_time",
    is_index=True,
    data_type=sy.DataType.TIMESTAMP,
    retrieve_if_name_exists=True,
)

# Create command channel
ao_0_cmd = client.channels.create(
    name="ao_0_cmd",
    index=ao_cmd_time.key,
    data_type=sy.DataType.FLOAT32,
    retrieve_if_name_exists=True,
)

# Create state time index
ao_state_time = client.channels.create(
    name="ao_state_time",
    is_index=True,
    data_type=sy.DataType.TIMESTAMP,
    retrieve_if_name_exists=True,
)

# Create state channel
ao_0_state = client.channels.create(
    name="ao_0_state",
    index=ao_state_time.key,
    data_type=sy.DataType.FLOAT32,
    retrieve_if_name_exists=True,
)

# Create and configure task
task = ni.AnalogWriteTask(
    name="Analog Write",
    state_rate=sy.Rate.HZ * 20,
    data_saving=True,
    channels=[
        ni.AOVoltageChan(
            cmd_channel=ao_0_cmd.key,
            state_channel=ao_0_state.key,
            device=dev.key,
            port=0,
            min_val=-10.0,
            max_val=10.0,
        ),
    ],
)

client.hardware.tasks.configure(task)

# Start task and write commands
with task.run():
    with client.open_writer(
        start=sy.TimeStamp.now(),
        channels=["ao_0_cmd"],
    ) as writer:
        # Set output to 5V
        writer.write({
            "ao_0_cmd": 5.0,
        })

        # Read back state
        with client.open_streamer(["ao_0_state"]) as streamer:
            frame = streamer.read()
            print(f"State: {frame['ao_0_state']}")
```

</ExampleDetails>

<ExampleDetails>
<Text.Text slot="summary" level="p"><Icon.Edit /> Edit Task Configuration</Text.Text>

```python
# TODO: Add example for editing task configuration
# - Update task parameters (state_rate, data_saving, etc.)
# - Modify channel parameters (min_val, max_val, etc.)
```

</ExampleDetails>

  </Fragment>
  <Fragment slot="typescript">

<ExampleDetails>
<Text.Text slot="summary" level="p"><Icon.Play /> Configure and Run Task</Text.Text>

```typescript
import { Synnax, TimeStamp, Rate } from "@synnaxlabs/client";

const client = new Synnax();

// Retrieve device
const dev = await client.hardware.devices.retrieve({ name: "my_daq" });

// Create command time index
const aoCmdTime = await client.channels.create({
  name: "ao_cmd_time",
  isIndex: true,
  dataType: "timestamp",
  retrieveIfNameExists: true,
});

// Create command channel
const ao0Cmd = await client.channels.create({
  name: "ao_0_cmd",
  index: aoCmdTime.key,
  dataType: "float32",
  retrieveIfNameExists: true,
});

// Create state time index
const aoStateTime = await client.channels.create({
  name: "ao_state_time",
  isIndex: true,
  dataType: "timestamp",
  retrieveIfNameExists: true,
});

// Create state channel
const ao0State = await client.channels.create({
  name: "ao_0_state",
  index: aoStateTime.key,
  dataType: "float32",
  retrieveIfNameExists: true,
});

// Create and configure task
const task = await client.hardware.tasks.create({
  name: "Analog Write",
  type: "ni_analog_write",
  config: JSON.stringify({
    state_rate: 20,
    data_saving: true,
    channels: [
      {
        type: "ao_voltage",
        cmd_channel: ao0Cmd.key,
        state_channel: ao0State.key,
        device: dev.key,
        port: 0,
        min_val: -10.0,
        max_val: 10.0,
      },
    ],
  }),
});

// Start task
await task.executeCommandSync("start");

// Write command
const writer = await client.openWriter({
  start: TimeStamp.now(),
  channels: ["ao_0_cmd"],
});

await writer.write({
  "ao_0_cmd": 5.0,
});

// Read state
const streamer = await client.openStreamer(["ao_0_state"]);
const frame = await streamer.read();
console.log(`State: ${frame["ao_0_state"]}`);

// Stop task
await task.executeCommandSync("stop");
await writer.close();
await streamer.close();
```

</ExampleDetails>

<ExampleDetails>
<Text.Text slot="summary" level="p"><Icon.Edit /> Edit Task Configuration</Text.Text>

```typescript
// TODO: Add example for editing task configuration
// - Update task parameters (state_rate, data_saving, etc.)
// - Modify channel parameters (min_val, max_val, etc.)
```

</ExampleDetails>

  </Fragment>
  <Fragment slot="cpp">

<ExampleDetails>
<Text.Text slot="summary" level="p"><Icon.Play /> Configure and Run Task</Text.Text>

```cpp
#include "client/cpp/synnax.h"

auto client = synnax::Synnax();

// Retrieve device
auto [dev, dev_err] = client.hardware.retrieve_device("my_daq");
if (dev_err) return dev_err;

// Create command time index
auto ao_cmd_time = synnax::Channel("ao_cmd_time", telem::TIMESTAMP_T, true);
auto cmd_time_err = client.channels.create(ao_cmd_time);
if (cmd_time_err) return cmd_time_err;

// Create command channel
auto ao_0_cmd = synnax::Channel("ao_0_cmd", telem::FLOAT32_T, ao_cmd_time.key, false);
auto cmd_err = client.channels.create(ao_0_cmd);
if (cmd_err) return cmd_err;

// Create state time index
auto ao_state_time = synnax::Channel("ao_state_time", telem::TIMESTAMP_T, true);
auto state_time_err = client.channels.create(ao_state_time);
if (state_time_err) return state_time_err;

// Create state channel
auto ao_0_state = synnax::Channel("ao_0_state", telem::FLOAT32_T, ao_state_time.key, false);
auto state_err = client.channels.create(ao_0_state);
if (state_err) return state_err;

// Create and configure task
// (Note: Task configuration in C++ typically done via driver directly)

// Start task and write commands
// Open writer to send commands
auto [writer, writer_err] = client.telem.open_writer(synnax::WriterConfig{
    std::vector{ao_0_cmd.key},
    synnax::TimeStamp::now()
});
if (writer_err) return writer_err;

// Set output to 5V
auto write_err = writer.write(synnax::Frame{
    {ao_0_cmd.key, telem::Series(std::vector<float>{5.0})}
});
if (write_err) return write_err;

// Read back state
auto [streamer, stream_err] = client.telem.open_streamer(synnax::StreamerConfig{
    std::vector{ao_0_state.key}
});
if (stream_err) return stream_err;

auto [frame, read_err] = streamer.read();
if (read_err) return read_err;

auto close_writer_err = writer.close();
if (close_writer_err) return close_writer_err;

auto close_streamer_err = streamer.close();
if (close_streamer_err) return close_streamer_err;
```

</ExampleDetails>

<ExampleDetails>
<Text.Text slot="summary" level="p"><Icon.Edit /> Edit Task Configuration</Text.Text>

```cpp
// TODO: Add example for editing task configuration
// - Update task parameters (state_rate, data_saving, etc.)
// - Modify channel parameters (min_val, max_val, etc.)
```

</ExampleDetails>

  </Fragment>
</Client.Tabs>

