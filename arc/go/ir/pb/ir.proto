// Code generated by oracle. DO NOT EDIT.

syntax = "proto3";

package arc.ir.pb;

import "arc/go/types/pb/types.proto";

option go_package = "github.com/synnaxlabs/arc/ir/pb";

// EdgeKind defines execution semantics for dataflow edges between nodes.
enum EdgeKind {
  EDGE_KIND_UNSPECIFIED = 0;
  EDGE_KIND_CONTINUOUS = 1;
  EDGE_KIND_ONE_SHOT = 2;
}

// Handle is a reference to a specific parameter on a specific node in the dataflow graph.
message Handle {
  // node is the node identifier.
  string node = 1;
  // param is the parameter name (input or output).
  string param = 2;
}

// Edge is a dataflow connection between node parameters in the Arc graph.
message Edge {
  // source is the source node parameter producing data.
  Handle source = 1;
  // target is the target node parameter consuming data.
  Handle target = 2;
  // kind defines execution semantics for this connection.
  EdgeKind kind = 3;
}
message StratumWrapper {
  repeated string values = 1;
}

// Stage is a stage in a sequence state machine, containing active nodes and their execution stratification.
message Stage {
  // key is the stage identifier.
  string key = 1;
  // nodes contains node keys active in this stage.
  repeated string nodes = 2;
  // strata contains execution stratification for nodes in this stage.
  repeated StratumWrapper strata = 3;
}

// Sequence is a state machine defining ordered stages of execution, where entry point is always the first stage.
message Sequence {
  // key is the sequence identifier.
  string key = 1;
  // stages contains ordered stages in this sequence.
  repeated Stage stages = 2;
}

// Body is raw function body source code with optional parsed AST.
message Body {
  // raw is the raw source code text.
  string raw = 1;
}

// Function is a function template definition with typed parameters, serving as a blueprint for node instantiation.
message Function {
  // key is the function identifier (template name).
  string key = 1;
  // body is raw source code for user-defined functions.
  Body body = 2;
  // config contains configuration parameter definitions.
  repeated .arc.types.pb.Param config = 3;
  // inputs contains input parameter definitions.
  repeated .arc.types.pb.Param inputs = 4;
  // outputs contains output parameter definitions.
  repeated .arc.types.pb.Param outputs = 5;
  // channels contains channel read/write declarations.
  .arc.types.pb.Channels channels = 6;
}

// Node is a concrete instantiation of a function with typed parameters and configuration values.
message Node {
  // key is the unique identifier for this node instance.
  string key = 1;
  // type is the function type being instantiated.
  string type = 2;
  // config contains configuration parameter values.
  repeated .arc.types.pb.Param config = 3;
  // inputs contains input parameter type signatures.
  repeated .arc.types.pb.Param inputs = 4;
  // outputs contains output parameter type signatures.
  repeated .arc.types.pb.Param outputs = 5;
  // channels contains channel read/write mappings.
  .arc.types.pb.Channels channels = 6;
}

// IR is the intermediate representation of an Arc program as a dataflow graph with stratified execution, bridging semantic analysis and WebAssembly compilation.
message IR {
  // functions contains function template definitions.
  repeated Function functions = 1;
  // nodes contains node instantiations.
  repeated Node nodes = 2;
  // edges contains dataflow connections.
  repeated Edge edges = 3;
  // strata contains execution stratification layers.
  repeated StratumWrapper strata = 4;
  // sequences contains state machine definitions.
  repeated Sequence sequences = 5;
}
