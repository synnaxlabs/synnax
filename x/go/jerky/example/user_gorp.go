// Code generated by jerky. DO NOT EDIT.

package example

import (
	"github.com/synnaxlabs/x/jerky/example/types"
	"github.com/google/uuid"
	"time"
	"github.com/synnaxlabs/x/telem"
	"google.golang.org/protobuf/proto"
)

// MarshalGorp serializes a User to bytes using protobuf.
func (m User) MarshalGorp() ([]byte, error) {
	return proto.Marshal(&types.User{
		Key: m.Key.String(),
		ID: uint32(m.ID),
		Name: m.Name,
		Email: m.Email,
		Age: m.Age,
		Active: m.Active,
		Balance: m.Balance,
		CreatedAt: m.CreatedAt.UnixNano(),
		LastSeen: int64(m.LastSeen),
		Tags: m.Tags,
		Role: m.Role,
		Verified: m.Verified,
		Score: m.Score,
		Department: m.Department,
		Address: AddressToProto(m.Address),
		Addresses: func() []*types.Address { result := make([]*types.Address, len(m.Addresses)); for i, v := range m.Addresses { result[i] = AddressToProto(v) }; return result }(),
	})
}

// UnmarshalGorp deserializes bytes into a User.
// It expects data to be in the current proto format. Run migrations at startup
// using UserMigrator to convert legacy data before normal operation.
func (m *User) UnmarshalGorp(data []byte) error {
	var pb types.User
	if err := proto.Unmarshal(data, &pb); err != nil {
		return err
	}
	var err error
	m.Key, err = uuid.Parse(pb.Key)
	if err != nil {
		return err
	}
	m.ID = UserID(pb.ID)
	m.Name = pb.Name
	m.Email = pb.Email
	m.Age = pb.Age
	m.Active = pb.Active
	m.Balance = pb.Balance
	m.CreatedAt = time.Unix(0, pb.CreatedAt)
	m.LastSeen = telem.TimeStamp(pb.LastSeen)
	m.Tags = pb.Tags
	m.Role = pb.Role
	m.Verified = pb.Verified
	m.Score = pb.Score
	m.Department = pb.Department
	m.Address = AddressFromProto(pb.Address)
	m.Addresses = func() []Address { result := make([]Address, len(pb.Addresses)); for i, v := range pb.Addresses { result[i] = AddressFromProto(v) }; return result }()
	return nil
}
