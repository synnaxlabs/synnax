// Code generated by jerky. DO NOT EDIT.

package example

import (
	"github.com/synnaxlabs/x/jerky/example/types"
	"github.com/google/uuid"
	"github.com/vmihailenco/msgpack/v5"
	"google.golang.org/protobuf/proto"
)

// MarshalGorp serializes a Group to bytes using protobuf.
func (m Group) MarshalGorp() ([]byte, error) {
	return proto.Marshal(&types.Group{
		Key: m.Key.String(),
		Name: m.Name,
		Description: m.Description,
		MemberCount: m.MemberCount,
	})
}

// UnmarshalGorp deserializes bytes into a Group.
// It expects data to be in the current proto format. Older versions should be
// migrated at startup using GroupMigrator before normal operation.
func (m *Group) UnmarshalGorp(data []byte) error {
	var pb types.Group
	if err := proto.Unmarshal(data, &pb); err == nil {
		var err error
		m.Key, err = uuid.Parse(pb.Key)
		if err != nil {
			return err
		}
		m.Name = pb.Name
		m.Description = pb.Description
		m.MemberCount = pb.MemberCount
		return nil
	}
	// Fall back to msgpack for pre-jerky (legacy) format.
	// Note: This only handles pre-jerky data, not older proto versions.
	// Run migrations at startup to convert old proto versions.
	return msgpack.Unmarshal(data, m)
}
