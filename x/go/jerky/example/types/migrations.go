// Code generated by jerky. DO NOT EDIT.

package types

import (
	"github.com/synnaxlabs/x/jerky/migrate"
	"google.golang.org/protobuf/proto"
)

// UserMigrations is the migration registry.
var UserMigrations = &migrate.Registry{
	TypeName:       "User",
	CurrentVersion: 3,
	Migrations: []migrate.Migration{
		{FromVersion: 0, ToVersion: 1, Migrate: migrateUserV0ToV1},
		{FromVersion: 1, ToVersion: 2, Migrate: migrateUserV1ToV2},
		{FromVersion: 2, ToVersion: 3, Migrate: migrateUserV2ToV3},
	},
}

func migrateUserV0ToV1(data []byte) ([]byte, error) {
	// V0 = msgpack, handled by gorp layer fallback
	// If we get here, data should already be proto
	var pb UserV1
	if err := proto.Unmarshal(data, &pb); err != nil {
		return nil, err
	}
	return data, nil
}

func migrateUserV1ToV2(data []byte) ([]byte, error) {
	var old UserV1
	if err := proto.Unmarshal(data, &old); err != nil {
		return nil, err
	}
	new := UserV2{
		Email: old.Email,
		ID: old.ID,
		Key: old.Key,
		Tags: old.Tags,
		Age: old.Age,
		Name: old.Name,
		Balance: old.Balance,
		Active: old.Active,
		CreatedAt: old.CreatedAt,
		LastSeen: old.LastSeen,
	}
	// Hook for custom field mappings (implement in migrations_custom.go)
	MigrateUserV1ToV2Hook(&old, &new)
	return proto.Marshal(&new)
}

func migrateUserV2ToV3(data []byte) ([]byte, error) {
	var old UserV2
	if err := proto.Unmarshal(data, &old); err != nil {
		return nil, err
	}
	new := UserV3{
		Balance: old.Balance,
		ID: old.ID,
		Name: old.Name,
		Age: old.Age,
		CreatedAt: old.CreatedAt,
		LastSeen: old.LastSeen,
		Tags: old.Tags,
		Key: old.Key,
		Email: old.Email,
		Active: old.Active,
		Role: old.Role,
	}
	// Hook for custom field mappings (implement in migrations_custom.go)
	MigrateUserV2ToV3Hook(&old, &new)
	return proto.Marshal(&new)
}
