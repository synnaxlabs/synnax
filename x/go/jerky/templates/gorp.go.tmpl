// Code generated by jerky. DO NOT EDIT.

package {{ .PackageName }}

import (
	"{{ .TypesImport }}"
{{- range .Imports }}
	"{{ . }}"
{{- end }}
	"github.com/vmihailenco/msgpack/v5"
	"google.golang.org/protobuf/proto"
)

// MarshalGorp serializes a {{ .TypeName }} to bytes using protobuf.
func (m {{ .TypeName }}) MarshalGorp() ([]byte, error) {
	return proto.Marshal(&types.{{ .TypeName }}{
{{- range .Fields }}
		{{ .ProtoName }}: {{ .ForwardExpr }},
{{- end }}
	})
}

// UnmarshalGorp deserializes bytes into a {{ .TypeName }}.
func (m *{{ .TypeName }}) UnmarshalGorp(data []byte) error {
	var pb types.{{ .TypeName }}
	if err := proto.Unmarshal(data, &pb); err == nil {
{{- range .Fields }}
		m.{{ .Name }} = {{ .BackwardExpr }}
{{- end }}
		return nil
	}
	// Fall back to msgpack (legacy format)
	return msgpack.Unmarshal(data, m)
}
