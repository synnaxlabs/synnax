// Code generated by jerky. DO NOT EDIT.

package {{ .PackageName }}

import (
	"{{ .TypesImport }}"
{{- range .Imports }}
	"{{ . }}"
{{- end }}
	"google.golang.org/protobuf/proto"
)

// MarshalGorp serializes a {{ .TypeName }} to bytes using protobuf.
func (m {{ .TypeName }}) MarshalGorp() ([]byte, error) {
	return proto.Marshal(&types.{{ .TypeName }}{
{{- range .Fields }}
		{{ .ProtoName }}: {{ .ForwardExpr }},
{{- end }}
	})
}

// UnmarshalGorp deserializes bytes into a {{ .TypeName }}.
// It expects data to be in the current proto format. Run migrations at startup
// using {{ .TypeName }}Migrator to convert legacy data before normal operation.
func (m *{{ .TypeName }}) UnmarshalGorp(data []byte) error {
	var pb types.{{ .TypeName }}
	if err := proto.Unmarshal(data, &pb); err != nil {
		return err
	}
{{- range .Fields }}
{{- if .CanFail }}
	var err error
	m.{{ .Name }}, err = {{ .BackwardExpr }}
	if err != nil {
		return err
	}
{{- else }}
	m.{{ .Name }} = {{ .BackwardExpr }}
{{- end }}
{{- end }}
	return nil
}
