// Code generated by jerky. DO NOT EDIT.

package user

import (
	"github.com/synnaxlabs/x/jerky/migrate"
	"github.com/vmihailenco/msgpack/v5"
	"google.golang.org/protobuf/proto"
)

// Migrations is the migration registry for User.
var Migrations = &migrate.Registry{
	TypeName:       "User",
	CurrentVersion: 1,
	Migrations: []migrate.Migration{
		{FromVersion: 0, ToVersion: 1, Migrate: migrateV0ToV1},
	},
}

func migrateV0ToV1(data []byte) ([]byte, error) {
	// Try proto first - data may already be migrated
	var pb V1
	if err := proto.Unmarshal(data, &pb); err == nil {
		return data, nil
	}

	// V0 = msgpack (pre-jerky legacy format)
	var v0 V0
	if err := msgpack.Unmarshal(data, &v0); err != nil {
		return nil, err
	}

	// Copy fields from v0 to v1 (types are identical)
	v1 := V1{
		Key: v0.Key,
		Username: v0.Username,
		FirstName: v0.FirstName,
		LastName: v0.LastName,
		RootUser: v0.RootUser,
	}
	return proto.Marshal(&v1)
}
