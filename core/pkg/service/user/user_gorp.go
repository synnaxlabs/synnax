// Code generated by jerky. DO NOT EDIT.

package user

import (
	user "github.com/synnaxlabs/synnax/pkg/service/user/types/user"
	"github.com/google/uuid"
	"google.golang.org/protobuf/proto"
)

// MarshalGorp serializes a User to bytes using protobuf.
func (m User) MarshalGorp() ([]byte, error) {
	return proto.Marshal(&user.Current{
		Key: m.Key.String(),
		Username: m.Username,
		FirstName: m.FirstName,
		LastName: m.LastName,
		RootUser: m.RootUser,
	})
}

// UnmarshalGorp deserializes bytes into a User.
// It expects data to be in the current proto format. Run migrations at startup
// using UserMigrator to convert legacy data before normal operation.
func (m *User) UnmarshalGorp(data []byte) error {
	var pb user.Current
	if err := proto.Unmarshal(data, &pb); err != nil {
		return err
	}
	var err error
	m.Key, err = uuid.Parse(pb.Key)
	if err != nil {
		return err
	}
	m.Username = pb.Username
	m.FirstName = pb.FirstName
	m.LastName = pb.LastName
	m.RootUser = pb.RootUser
	return nil
}
