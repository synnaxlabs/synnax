---
# Synnax C++ Linting Configuration
# This configuration enforces code quality, security, and performance standards
# across all C++ codebases (driver, client/cpp, freighter/cpp, x/cpp)

Checks: |

    bugprone-*,
    # flags (int x, int y), too noisy
    -bugprone-easily-swappable-parameters,
    # false positives with RAII wrappers
    -bugprone-exception-escape,
    cert-*,
    # too strict for static constants
    -cert-err58-cpp,
    # alias of uppercase-literal-suffix
    -cert-dcl16-c,
    performance-*,
    modernize-*,
    # C API interop (Lua, NI-DAQmx, libmodbus)
    -modernize-avoid-c-arrays,
    # style preference
    -modernize-return-braced-init-list,
    # not always clearer
    -modernize-use-designated-initializers,
    # style preference
    -modernize-use-trailing-return-type,
    readability-*,
    # style preference
    -readability-braces-around-statements,
    # flags i/j/k loop counters
    -readability-identifier-length,
    # int x, y; is acceptable
    -readability-isolate-declaration,
    # too noisy
    -readability-magic-numbers,
    # precedence is well-known
    -readability-math-missing-parentheses,
    # default init can be intentional
    -readability-redundant-member-init,
    # style preference
    -readability-uppercase-literal-suffix,
    # not always more readable
    -readability-use-anyofallof,
    # style preference - namespace closing comments
    -readability-namespace-comments,
    cppcoreguidelines-*,
    # C API interop
    -cppcoreguidelines-avoid-c-arrays,
    # immutable members are valid
    -cppcoreguidelines-avoid-const-or-ref-data-members,
    # do-while is legitimate
    -cppcoreguidelines-avoid-do-while,
    # alias of readability version
    -cppcoreguidelines-avoid-magic-numbers,
    # protobuf generated code uses mutable globals
    -cppcoreguidelines-avoid-non-const-global-variables,
    # C libraries use macros
    -cppcoreguidelines-macro-usage,
    # POD structs are valid
    -cppcoreguidelines-non-private-member-variables-in-classes,
    # C API interop
    -cppcoreguidelines-pro-bounds-array-to-pointer-decay,
    # performance-critical code; bounds already validated
    -cppcoreguidelines-pro-bounds-avoid-unchecked-container-access,
    # C API interop
    -cppcoreguidelines-pro-bounds-pointer-arithmetic,
    # C callbacks require const removal
    -cppcoreguidelines-pro-type-const-cast,
    # binary protocols
    -cppcoreguidelines-pro-type-reinterpret-cast,
    # prefer Rule of 0; too noisy for virtual dtors
    -cppcoreguidelines-special-member-functions,
    # NI-DAQmx C API requires raw pointer arrays
    -cppcoreguidelines-owning-memory,
    clang-analyzer-*,
    misc-*,
    # experimental, many false positives
    -misc-include-cleaner,
    # legitimate algorithms use recursion
    -misc-no-recursion,
    # POD structs are valid
    -misc-non-private-member-variables-in-classes,
    # header-only utilities need external linkage
    -misc-use-internal-linkage,
    portability-*,
    # widely supported
    -portability-avoid-pragma-once,
    # MSVC extension used by deps
    -portability-template-virtual-member-function,
    concurrency-*,
    hicpp-*,
    # C API interop
    -hicpp-avoid-c-arrays,
    # style preference
    -hicpp-braces-around-statements,
    # C API interop
    -hicpp-no-array-decay,
    # hardware register manipulation
    -hicpp-signed-bitwise,
    # alias of cppcoreguidelines version
    -hicpp-special-member-functions,
    # style preference
    -hicpp-uppercase-literal-suffix,
    google-build-namespaces,
    google-explicit-constructor,
    google-runtime-int,
    google-runtime-operator,
    # style preference
    -google-readability-namespace-comments,
    # flakey
    -clang-diagnostic-pragma-once-outside-header

# Treat warnings as errors in CI
WarningsAsErrors: "*"

# Disable compiler diagnostics that can't be suppressed via Checks
ExtraArgsBefore:
  - -Wno-pragma-once-outside-header

# Use .clang-format file for formatting
FormatStyle: file

CheckOptions:
    # C++23 standard is used across the codebase
    - key: modernize-replace-auto-ptr.IncludeStyle
      value: llvm
    - key: modernize-use-nullptr.NullMacros
      value: "NULL"

    # Naming conventions
    # Classes/Structs: PascalCase
    - key: readability-identifier-naming.ClassCase
      value: CamelCase
    - key: readability-identifier-naming.StructCase
      value: CamelCase

    # Functions/Methods: snake_case
    - key: readability-identifier-naming.FunctionCase
      value: lower_case
    - key: readability-identifier-naming.MethodCase
      value: lower_case

    # Variables: snake_case
    - key: readability-identifier-naming.VariableCase
      value: lower_case
    - key: readability-identifier-naming.ParameterCase
      value: lower_case
    # Allow Lua state parameter 'L' - conventional in Lua C API
    - key: readability-identifier-naming.ParameterIgnoredRegexp
      value: "^L$"
    # Members: snake_case (trailing underscore allowed via regex for disambiguation)
    - key: readability-identifier-naming.MemberCase
      value: lower_case
    - key: readability-identifier-naming.MemberIgnoredRegexp
      value: ".*_"
    # Static members: allow UPPER_CASE for constant-like static members (e.g., DENSITIES)
    - key: readability-identifier-naming.StaticVariableCase
      value: lower_case
    - key: readability-identifier-naming.StaticVariableIgnoredRegexp
      value: "[A-Z][A-Z_0-9]*"
    - key: readability-identifier-naming.ClassMemberCase
      value: lower_case
    - key: readability-identifier-naming.ClassMemberIgnoredRegexp
      value: "[A-Z][A-Z_0-9]*|.*_"

    # Constants: UPPER_CASE (SCREAM_CASE) for global/static constants
    # Note: ConstexprVariableCase is omitted to allow local constexpr to use snake_case
    # Global/static constexpr are still caught since constexpr implies const
    - key: readability-identifier-naming.GlobalConstantCase
      value: UPPER_CASE
    - key: readability-identifier-naming.StaticConstantCase
      value: UPPER_CASE

    # Namespaces: lower_case
    - key: readability-identifier-naming.NamespaceCase
      value: lower_case

    # Allow single-letter variable names in limited scopes (loop counters, etc.)
    - key: readability-identifier-naming.IgnoreFailedSplit
      value: true

    # Performance tuning
    - key: performance-move-const-arg.CheckTriviallyCopyableMove
      value: false
    - key: performance-unnecessary-value-param.AllowedTypes
      value: ""

    # Modernize settings
    - key: modernize-use-auto.MinTypeNameLength
      value: 5
    - key: modernize-use-auto.RemoveStars
      value: false

    # Ignore glog's verbose_level__ macro and parser false positives
    - key: misc-const-correctness.AllowedTypes
      value: "google::int32;xjson::Parser"

    # Readability settings
    - key: readability-function-cognitive-complexity.Threshold
      value: 50
    - key: readability-function-size.LineThreshold
      value: 200
    - key: readability-function-size.StatementThreshold
      value: 150

# Only check our own headers, not vendor code or system headers
# Excludes:
#   - driver/labjack/ljm (LabJack SDK vendor code)
#   - driver/ni/daqmx (NI-DAQmx API wrappers with NI naming conventions)
#   - driver/ni/syscfg (NI System Configuration API wrappers)
HeaderFilterRegex: '(driver/(cmd|daemon|errors|modbus|ni/channel|ni/hardware|opc|pipeline|rack|sequence|task|transform|labjack/device)/|driver/ni/[^/]+\.(h|hpp)$|client/cpp/|freighter/cpp/|x/cpp/)'

# Use compilation database generated by Bazel
UseColor: true
